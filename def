import shelve
import os
import glob

def baselinePair(baselineDir, reference, secondary, doBaselines=True):

    def get_db_file(path):
        """获取对应的数据库文件路径"""
        # 获取路径的最后一个组件（日期）
        date = os.path.basename(path)
        base_dir = os.path.dirname(path)
        
        # 尝试可能的数据库文件后缀
        possible_suffixes = ['.dat', '.db']
        for suffix in possible_suffixes:
            db_file = os.path.join(base_dir, f"{date}{suffix}")
            if os.path.exists(db_file):
                return db_file
                
        # 如果找不到数据库文件，检查raw文件是否存在
        raw_file = os.path.join(base_dir, f"{date}.raw")
        if not os.path.exists(raw_file):
            raise FileNotFoundError(f"找不到raw文件：{raw_file}")
        
        # 如果只有raw文件存在，尝试使用raw文件的基础名
        return os.path.join(base_dir, f"{date}")

    if doBaselines: # open files to calculate baselines
        try:
            ref_db = get_db_file(reference)
            sec_db = get_db_file(secondary)
            
            mdb = shelve.open(ref_db, flag='r')
            sdb = shelve.open(sec_db, flag='r')
        except FileNotFoundError as e:
            raise e
        except Exception as e:
            raise Exception(f"打开数据库文件时出错：{str(e)}\n参考文件：{reference}\n次要文件：{secondary}")

    # ... existing code ... 